---
description: Master audit rule to prevent 150+ common mistakes in Project Atomic
globs: **/*
alwaysApply: true
---

# üõ°Ô∏è Atomic Audit Mandate

V√≥√≥r elke taak, edit of push MOET de agent een "Forensische Zelf-Audit" uitvoeren tegen de 150+ common mistakes.

## üîç De "Atomic Check" Procedure (ROOT-CAUSE FIRST)

V√≥√≥r het schrijven van ook maar √©√©n regel code, MOET de agent de volgende stappen doorlopen:

1.  **FORENSIC ROOT-CAUSE ANALYSIS**: 
    - Doe een diepe scan naar de bron van het probleem (Database, API-payload, of Frontend State).
    - **Proactive Diagnostic Ownership**: Wacht NOOIT op logs van de USER. Gebruik de zelf-gecre√´erde Watchdog (`system_events`) en Browser-agent om de bron te vinden. Jij bent de architect √©n de inspecteur.
    - Gebruik `browser-use` of rauwe SQL om de "Source of Truth" te verifi√´ren. Gissen is verboden.
2.  **THE TRINITY OF VALIDATION**:
    - Elke fix moet gevalideerd worden op drie niveaus:
        1. **Browser**: Functionele interactie via `browser-use`.
        2. **Watchdog**: Server-side events in de `system_events` tabel.
        3. **Console**: Client-side errors in de browser logs.
3.  **FOUT-UITSLUITING (Pre-emptive Strike)**:
    - Identificeer alle mogelijke zij-effecten (bijv. "Als ik de filter strikter maak, breekt dan de zoekfunctie?").
    - Controleer of de benodigde data (zoals IDs) wel in de API-tunnel zit.
4.  **DRIEPUNT-OPLOSSING (The Trinity Check)**:
    - Formuleer intern (of in de chat) 3 mogelijke oplossingen.
    - Vergelijk ze op: Performance, Architectuur (Chris-Protocol) en Robuustheid.
    - Kies de beste oplossing en beargumenteer *waarom* dit de Masterclass-keuze is.
4.  **Symbol Trace**: Traceer elk symbool (markt, taal, config) terug naar de `MarketManager`.
5.  **Hardcode Hunt**: Zoek naar verboden strings (`voices.be`, `johfrah.be`, hardcoded emails/telefoons).
6.  **ISO Verify**: Controleer of taal-codes strikt ISO-5 zijn (`nl-BE`, niet `nl` of `Vlaams`).
7.  **Instrument Check**: Controleer of er rauwe HTML wordt gebruikt ipv `LayoutInstruments`.
8.  **Nuclear Lock**: Verifieer of `isManuallyEdited` velden worden gerespecteerd in sync-scripts.
9.  **API Hardening**: Kritieke API routes (Auth, Admin, Checkout) MOETEN `export const dynamic = 'force-dynamic'` hebben en gedetailleerde foutmeldingen teruggeven bij falen (geen generieke 500's).

## üö´ Verboden Patronen (Zero Tolerance)

- **GEEN** relatieve imports naar andere packages (`../../packages`). Gebruik `@db` of `@database/schema`.
- **GEEN** generieke foutmeldingen in API's. De browser moet weten *waarom* het faalt.
- **GEEN** "behulpzame" interpretatie van filters. De taalfilter is de moedertaal (Native ID). Punt.
- **GEEN** code schrijven zonder eerst de API-payload te hebben gezien.
- **GEEN** `host.includes()` in UI componenten. Gebruik `market.market_code`.
- **GEEN** hardcoded fallbacks voor contactgegevens. Gebruik `market.email` / `market.phone`.
- **GEEN** hashtags in URLs (`#demos`). Gebruik clean routes (`/demos`).
- **GEEN** Uppercase in koppen. Gebruik Natural Capitalization.
- **GEEN** `any` types. Gebruik strikte interfaces.
- **GEEN** aannames over data. Bij twijfel: draai ALTIJD een rauwe SQL query op de database om de "Source of Truth" te verifi√´ren.

## üöÄ De "Chris-Protocol" Veto
Als een wijziging √©√©n van de bovenstaande regels schendt, is de code "Slop" en mag deze NIET gepusht worden. Chris eist 100% Masterclass kwaliteit.

"Beter 10x controleren dan 1x slop introduceren." - Chris/Autist