---
description: Standard procedure for pushing code and validating the deployment via forensic logs.
alwaysApply: true
---

# üöÄ Push & Validate Standard Procedure (Nuclear Mode)

Dit protocol garandeert dat elke wijziging niet alleen wordt gepusht, maar ook daadwerkelijk succesvol draait in de productie-omgeving zonder rimpels.

## üìã De Standaard Procedure

V√≥√≥r elke afronding van een taak MOET de agent de volgende stappen doorlopen:

1.  **Zero-Slop Pre-Flight**: 
    - Voer ALTIJD `npm run type-check` uit in `1-SITE/apps/web`.
    - Controleer handmatig ELKE import in de gewijzigde bestanden. Geen ontbrekende iconen of componenten.
2.  **Pre-Vercel Check**: Voer `npm run check:pre-vercel` uit vanuit de root of `1-SITE/apps/web`. Dit voert een volledige build uit en scant op Nuclear Law schendingen.
3.  **Versiebeheer (Version Sync Mandate)**: 
    - **Check Remote First**: Voer ALTIJD eerst `git fetch origin main` uit en controleer de laatste commit message/versie in de remote repository voordat je een nieuwe versie bepaalt.
    - Verhoog de `version` in `1-SITE/apps/web/package.json` op basis van de HOOGSTE bekende versie (lokaal of remote).
    - Synchroniseer deze versie EXACT in `1-SITE/apps/web/src/app/Providers.tsx` (`currentVersion`).
    - Synchroniseer deze versie EXACT in `1-SITE/apps/web/src/app/api/admin/config/route.ts` (`_version`).
    - Dit is cruciaal voor de `VersionGuard` om browser-reloads te forceren.
4.  **Atomic Audit**: Voer de `000-ATOMIC-AUDIT.mdc` uit.
5.  **Push**: Voer `git add . && git commit -m "vX.Y.Z: [Bericht]" && git push` uit.
5.  **Wacht op Build**: Wacht minimaal 60-90 seconden tot Vercel de build heeft voltooid.
6.  **Forensische Audit**: Voer het validatie-script uit om de live logs te controleren:
    ```bash
    npx tsx 3-WETTEN/scripts/forensic-audit.ts
    ```
28. **Functional Browser Validation (The Final Gate)**:
 - Gebruik de `browser-use` subagent om de wijziging *functioneel* te testen op de live site.
 - **Incognito & Hard Refresh**: Test de live URL incognito. Voer een hard-refresh uit om caching te omzeilen.
 - **Version Match Mandate**: De browser-agent MOET de versie in de UI of `/api/admin/config` verifi√´ren tegen de zojuist gepushte versie in `package.json`. Geen match = herhaal check na 30s.
 - **Console & Watchdog Audit**: Verifieer dat de console 100% schoon is en er geen nieuwe `system_events` errors zijn in de database.
 - **Data Visibility & Proof**: Bevestig expliciet dat de verwachte data zichtbaar is. Noem een specifiek detail dat je ziet (bijv. "Ik zie de nieuwe knop 'Boek Nu' met kleur #000").
 - **Regression Check**: Bevestig dat de hoofdnavigatie en de 'Slimme Kassa' nog steeds functioneren na de fix.
 - **MANDATORY EVIDENCE**: Kopieer de browser-console output naar je eindrapportage om 0 errors te bewijzen.
29. **Certificering**: De taak mag pas als "COMPLETED" worden gemarkeerd als:
    - De build succesvol is.
    - De `forensic-audit.ts` ‚úÖ groen geeft.
    - De browser-agent de functionaliteit heeft bevestigd op de PRODUCTIE URL zonder console/watchdog errors.
    - **GEEN INSTRUCTIES AAN DE GEBRUIKER**: Geef geen instructies om zelf te testen. Bevestig dat JIJ het hebt gezien.
    - **EVIDENCE MANDATE**: Lever een korte 'Proof of Life' (bijv. "Getest op voices.be, versie v1.0.8 is live, knop reageert binnen 50ms").

## üö´ Verboden Patronen

- **GEEN** push zonder voorafgaande succesvolle `npm run check:pre-vercel`.
- **GEEN** push zonder versie-verhoging.
- **GEEN** taak afronden zonder de live logs te checken.
- **GEEN** taak afronden zonder een functionele browser-test (voor UI/API wijzigingen).
- **GEEN** negeren van waarschuwingen in de `forensic-audit.ts`.

## üõ†Ô∏è Herstel bij Foutmeldingen

Indien de `forensic-audit.ts` fouten rapporteert:
1.  Analyseer de stack-trace in de details van het log.
2.  Pas de code direct aan.
3.  Herhaal de push-procedure met een nieuwe patch-versie.

"Een push is pas een succes als de logs zwijgen." - Chris/Autist
